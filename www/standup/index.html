<html>
	<head>
	<script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.3.0/stitch.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>
	<title>Get Up, StitchUp!</title>
	</head>

	<body>
		<h1 id="standupname">Standup: Australia TSE Standup</h1>

		<p>
		Next scheduled time: <span id="scheduledtime">11:00am, Thursday 14 February 2019</span>

		<div style="display: flex; width: 100%;">

		<div class="participants" style="width: 33%">

		</div>

		<div class="countdown" style="width: 33%">
		HH:MM:SS
		</div>

		<p>
		Actions:
		<ul>
			<li><a href="">Delay 5 mins</a>
			<li><a href="">Can't make it</a>
			<li><a href="">...</a>
		</ul>

	</body>

<script>
const client = stitch.Stitch.initializeDefaultAppClient('stitchuplocal-hxiso');

const db = client.getServiceClient(stitch.RemoteMongoClient.factory, 'mongodb-atlas').db('stitchup');

console.log(client.auth.hasRedirectResult());
console.log(client.auth.isLoggedIn);

function populatePage() {

	//db.collection('standups').find({participant_id: client.auth.user.id}).asArray().then( docs => {
	//	console.log("Found docs", docs)
	//	var standuplist = $("#standuplist");
	//	for (var doc in docs) {
	//		standuplist.append($("li").text(doc.id));
	//	}
	//}).catch(err => {
	//	console.error(err)
	//});

}

if (client.auth.hasRedirectResult()) {
    client.auth.handleRedirectResult().then(user => {
        console.log("redirect result", user);
		populatePage();
    });
} else {

	if (!client.auth.isLoggedIn) {
		client.auth.loginWithRedirect(new stitch.GoogleRedirectCredential());
	} else {
        console.log("logged in", client.auth);
		populatePage();
	}
}

</script>

</html>
